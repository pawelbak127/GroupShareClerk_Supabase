"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/offers/route";
exports.ids = ["app/api/offers/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:async_hooks":
/*!***********************************!*\
  !*** external "node:async_hooks" ***!
  \***********************************/
/***/ ((module) => {

module.exports = require("node:async_hooks");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:path":
/*!****************************!*\
  !*** external "node:path" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("node:path");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Foffers%2Froute&page=%2Fapi%2Foffers%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Foffers%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShareClerk_Supabase%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShareClerk_Supabase%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Foffers%2Froute&page=%2Fapi%2Foffers%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Foffers%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShareClerk_Supabase%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShareClerk_Supabase%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_bacze_Project_GroupShareClerk_Supabase_groupshare_project_src_app_api_offers_route_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/offers/route.js */ \"(rsc)/./src/app/api/offers/route.js\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/offers/route\",\n        pathname: \"/api/offers\",\n        filename: \"route\",\n        bundlePath: \"app/api/offers/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\bacze\\\\Project\\\\GroupShareClerk_Supabase\\\\groupshare-project\\\\src\\\\app\\\\api\\\\offers\\\\route.js\",\n    nextConfigOutput,\n    userland: C_Users_bacze_Project_GroupShareClerk_Supabase_groupshare_project_src_app_api_offers_route_js__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/offers/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZvZmZlcnMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRm9mZmVycyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRm9mZmVycyUyRnJvdXRlLmpzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNiYWN6ZSU1Q1Byb2plY3QlNUNHcm91cFNoYXJlQ2xlcmtfU3VwYWJhc2UlNUNncm91cHNoYXJlLXByb2plY3QlNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUNVc2VycyU1Q2JhY3plJTVDUHJvamVjdCU1Q0dyb3VwU2hhcmVDbGVya19TdXBhYmFzZSU1Q2dyb3Vwc2hhcmUtcHJvamVjdCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDd0Q7QUFDckk7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ncm91cHNoYXJlLXByb2plY3QvP2NmYzMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxcVXNlcnNcXFxcYmFjemVcXFxcUHJvamVjdFxcXFxHcm91cFNoYXJlQ2xlcmtfU3VwYWJhc2VcXFxcZ3JvdXBzaGFyZS1wcm9qZWN0XFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXG9mZmVyc1xcXFxyb3V0ZS5qc1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvb2ZmZXJzL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvb2ZmZXJzXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9vZmZlcnMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxiYWN6ZVxcXFxQcm9qZWN0XFxcXEdyb3VwU2hhcmVDbGVya19TdXBhYmFzZVxcXFxncm91cHNoYXJlLXByb2plY3RcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcb2ZmZXJzXFxcXHJvdXRlLmpzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9vZmZlcnMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Foffers%2Froute&page=%2Fapi%2Foffers%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Foffers%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShareClerk_Supabase%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShareClerk_Supabase%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/offers/route.js":
/*!*************************************!*\
  !*** ./src/app/api/offers/route.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(rsc)/./node_modules/@clerk/nextjs/dist/esm/app-router/server/currentUser.js\");\n/* harmony import */ var _lib_auth_service__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../lib/auth-service */ \"(rsc)/./src/lib/auth-service.js\");\n/* harmony import */ var _lib_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../lib/supabase-admin-client */ \"(rsc)/./src/lib/supabase-admin-client.js\");\nconst dynamic = \"force-dynamic\";\n\n\n\n\n/**\r\n * GET /api/offers\r\n * Get subscription offers with optional filtering\r\n */ async function GET(request) {\n    try {\n        // Parse query parameters\n        const { searchParams } = new URL(request.url);\n        // Używaj bezpośrednio supabaseAdmin zamiast prób z wieloma klientami\n        let supabaseClient = _lib_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"];\n        // Parse filters from query parameters\n        const filters = {\n            platformId: searchParams.get(\"platformId\") || undefined,\n            minPrice: searchParams.get(\"minPrice\") ? parseFloat(searchParams.get(\"minPrice\")) : undefined,\n            maxPrice: searchParams.get(\"maxPrice\") ? parseFloat(searchParams.get(\"maxPrice\")) : undefined,\n            availableSlots: searchParams.get(\"availableSlots\") !== \"false\",\n            orderBy: searchParams.get(\"orderBy\") || \"created_at\",\n            ascending: searchParams.get(\"ascending\") === \"true\",\n            limit: searchParams.get(\"limit\") ? parseInt(searchParams.get(\"limit\")) : 10,\n            offset: searchParams.get(\"offset\") ? parseInt(searchParams.get(\"offset\")) : 0\n        };\n        // Przygotowanie zapytania\n        let query = supabaseClient.from(\"group_subs\").select(`\r\n        *,\r\n        subscription_platforms(*),\r\n        groups(id, name, description),\r\n        owner:groups!inner(owner_id, user_profiles!inner(id, display_name, avatar_url, rating_avg, rating_count, verification_level))\r\n      `).eq(\"status\", \"active\");\n        // Dodaj filtr na platformę\n        if (filters.platformId) {\n            query = query.eq(\"platform_id\", filters.platformId);\n        }\n        // Dodaj filtr na cenę minimalną\n        if (filters.minPrice !== undefined && !isNaN(filters.minPrice)) {\n            query = query.gte(\"price_per_slot\", filters.minPrice);\n        }\n        // Dodaj filtr na cenę maksymalną\n        if (filters.maxPrice !== undefined && !isNaN(filters.maxPrice)) {\n            query = query.lte(\"price_per_slot\", filters.maxPrice);\n        }\n        // Filtruj oferty tylko z dostępnymi miejscami\n        if (filters.availableSlots !== false) {\n            query = query.gt(\"slots_available\", 0);\n        }\n        // Sortowanie\n        const orderBy = filters.orderBy || \"created_at\";\n        const ascending = filters.ascending || false;\n        query = query.order(orderBy, {\n            ascending\n        });\n        // Limit i paginacja\n        if (filters.limit) {\n            query = query.limit(filters.limit);\n        }\n        if (filters.offset) {\n            query = query.offset(filters.offset);\n        }\n        try {\n            // Wykonaj zapytanie\n            const { data, error } = await query;\n            if (error) {\n                console.error(\"Error fetching subscription offers:\", error);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: error.message || \"Failed to fetch subscription offers\",\n                    code: error.code || \"unknown\"\n                }, {\n                    status: 500\n                });\n            }\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(data || []);\n        } catch (queryError) {\n            console.error(\"Exception executing query:\", queryError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to execute database query\",\n                details: queryError.message\n            }, {\n                status: 500\n            });\n        }\n    } catch (error) {\n        console.error(\"Error fetching offers:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error.message || \"Failed to fetch subscription offers\",\n            code: error.code || \"unknown\"\n        }, {\n            status: 500\n        });\n    }\n}\n/**\r\n * POST /api/offers\r\n * Create a new subscription offer\r\n */ async function POST(request) {\n    try {\n        // Verify user is authenticated\n        const user = await (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_3__.currentUser)();\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        // Get user profile using admin client\n        const profile = await (0,_lib_auth_service__WEBPACK_IMPORTED_MODULE_1__.getCurrentUserProfile)();\n        if (!profile) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"User profile not found\"\n            }, {\n                status: 404\n            });\n        }\n        // Parse request body\n        const body = await request.json();\n        // Validate required fields\n        const requiredFields = [\n            \"groupId\",\n            \"platformId\",\n            \"slotsTotal\",\n            \"pricePerSlot\",\n            \"accessInstructions\"\n        ];\n        for (const field of requiredFields){\n            if (!body[field]) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: `Missing required field: ${field}`\n                }, {\n                    status: 400\n                });\n            }\n        }\n        // Validate numeric fields\n        if (isNaN(parseFloat(body.pricePerSlot)) || parseFloat(body.pricePerSlot) <= 0) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Price per slot must be a positive number\"\n            }, {\n                status: 400\n            });\n        }\n        if (!Number.isInteger(body.slotsTotal) || body.slotsTotal <= 0) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Slots total must be a positive integer\"\n            }, {\n                status: 400\n            });\n        }\n        // Prepare the offer data\n        const offerData = {\n            group_id: body.groupId,\n            platform_id: body.platformId,\n            status: \"active\",\n            slots_total: body.slotsTotal,\n            slots_available: body.slotsTotal,\n            price_per_slot: body.pricePerSlot,\n            currency: body.currency || \"PLN\",\n            instant_access: true // All offers now have instant access\n        };\n        // Verify if user owns the group using admin client\n        try {\n            const { data: groupData, error: groupError } = await _lib_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"groups\").select(\"owner_id\").eq(\"id\", body.groupId).single();\n            if (groupError) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Group not found or you do not have permission\",\n                    details: groupError.message\n                }, {\n                    status: 403\n                });\n            }\n            if (groupData.owner_id !== profile.id) {\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"You do not have permission to create offers for this group\"\n                }, {\n                    status: 403\n                });\n            }\n        } catch (groupCheckError) {\n            console.error(\"Error checking group ownership:\", groupCheckError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Failed to verify group ownership\",\n                details: groupCheckError.message\n            }, {\n                status: 500\n            });\n        }\n        // Create offer with admin client\n        let createdOffer;\n        try {\n            const { data, error } = await _lib_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"group_subs\").insert(offerData).select().single();\n            if (error) {\n                console.error(\"Error creating offer:\", error);\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: error.message || \"Failed to create subscription offer\",\n                    code: error.code\n                }, {\n                    status: 500\n                });\n            }\n            createdOffer = data;\n        } catch (createError) {\n            console.error(\"Exception creating offer:\", createError);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Exception while creating offer\",\n                details: createError.message\n            }, {\n                status: 500\n            });\n        }\n        // Check result\n        if (!createdOffer || !createdOffer.id) {\n            console.warn(\"Offer creation response missing ID\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Offer was created but returned invalid data\"\n            }, {\n                status: 500\n            });\n        }\n        // Store access instructions\n        try {\n            const { error: instructionsError } = await _lib_supabase_admin_client__WEBPACK_IMPORTED_MODULE_2__[\"default\"].from(\"access_instructions\").insert({\n                group_sub_id: createdOffer.id,\n                instructions: body.accessInstructions,\n                updated_at: new Date().toISOString()\n            });\n            if (instructionsError) {\n                console.error(\"Failed to save access instructions:\", instructionsError);\n            }\n        } catch (instructionsError) {\n            console.error(\"Error saving access instructions:\", instructionsError);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(createdOffer, {\n            status: 201\n        });\n    } catch (error) {\n        console.error(\"Error creating offer:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error.message || \"Failed to create subscription offer\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UUFFQSxlQUFlO1FBQ2YsSUFBSSxDQUFDNEIsZ0JBQWdCLENBQUNBLGFBQWFGLEVBQUUsRUFBRTtZQUNyQzlCLFFBQVFtQyxJQUFJLENBQUM7WUFDYixPQUFPckUscURBQVlBLENBQUNtQyxJQUFJLENBQ3RCO2dCQUFFRixPQUFPO1lBQThDLEdBQ3ZEO2dCQUFFSyxRQUFRO1lBQUk7UUFFbEI7UUFFQSw0QkFBNEI7UUFDNUIsSUFBSTtZQUNGLE1BQU0sRUFBRUwsT0FBT3FDLGlCQUFpQixFQUFFLEdBQUcsTUFBTW5FLGtFQUFhQSxDQUNyRHFCLElBQUksQ0FBQyx1QkFDTDJDLE1BQU0sQ0FBQztnQkFDTkksY0FBY0wsYUFBYUYsRUFBRTtnQkFDN0JRLGNBQWM1QixLQUFLNkIsa0JBQWtCO2dCQUNyQ0MsWUFBWSxJQUFJQyxPQUFPQyxXQUFXO1lBQ3BDO1lBRUYsSUFBSU4sbUJBQW1CO2dCQUNyQnBDLFFBQVFELEtBQUssQ0FBQyx1Q0FBdUNxQztZQUN2RDtRQUNGLEVBQUUsT0FBT0EsbUJBQW1CO1lBQzFCcEMsUUFBUUQsS0FBSyxDQUFDLHFDQUFxQ3FDO1FBQ3JEO1FBRUEsT0FBT3RFLHFEQUFZQSxDQUFDbUMsSUFBSSxDQUFDK0IsY0FBYztZQUFFNUIsUUFBUTtRQUFJO0lBQ3ZELEVBQUUsT0FBT0wsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMseUJBQXlCQTtRQUN2QyxPQUFPakMscURBQVlBLENBQUNtQyxJQUFJLENBQ3RCO1lBQUVGLE9BQU9BLE1BQU1HLE9BQU8sSUFBSTtRQUFzQyxHQUNoRTtZQUFFRSxRQUFRO1FBQUk7SUFFbEI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2dyb3Vwc2hhcmUtcHJvamVjdC8uL3NyYy9hcHAvYXBpL29mZmVycy9yb3V0ZS5qcz85ZjMyIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBkeW5hbWljID0gJ2ZvcmNlLWR5bmFtaWMnO1xyXG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IGN1cnJlbnRVc2VyIH0gZnJvbSAnQGNsZXJrL25leHRqcy9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBnZXRDdXJyZW50VXNlclByb2ZpbGUgfSBmcm9tICcuLi8uLi8uLi9saWIvYXV0aC1zZXJ2aWNlJztcclxuaW1wb3J0IHN1cGFiYXNlQWRtaW4gZnJvbSAnLi4vLi4vLi4vbGliL3N1cGFiYXNlLWFkbWluLWNsaWVudCc7XHJcblxyXG4vKipcclxuICogR0VUIC9hcGkvb2ZmZXJzXHJcbiAqIEdldCBzdWJzY3JpcHRpb24gb2ZmZXJzIHdpdGggb3B0aW9uYWwgZmlsdGVyaW5nXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgLy8gUGFyc2UgcXVlcnkgcGFyYW1ldGVyc1xyXG4gICAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpO1xyXG4gICAgXHJcbiAgICAvLyBVxbx5d2FqIGJlenBvxZtyZWRuaW8gc3VwYWJhc2VBZG1pbiB6YW1pYXN0IHByw7NiIHogd2llbG9tYSBrbGllbnRhbWlcclxuICAgIGxldCBzdXBhYmFzZUNsaWVudCA9IHN1cGFiYXNlQWRtaW47XHJcbiAgICBcclxuICAgIC8vIFBhcnNlIGZpbHRlcnMgZnJvbSBxdWVyeSBwYXJhbWV0ZXJzXHJcbiAgICBjb25zdCBmaWx0ZXJzID0ge1xyXG4gICAgICBwbGF0Zm9ybUlkOiBzZWFyY2hQYXJhbXMuZ2V0KCdwbGF0Zm9ybUlkJykgfHwgdW5kZWZpbmVkLFxyXG4gICAgICBtaW5QcmljZTogc2VhcmNoUGFyYW1zLmdldCgnbWluUHJpY2UnKSA/IHBhcnNlRmxvYXQoc2VhcmNoUGFyYW1zLmdldCgnbWluUHJpY2UnKSkgOiB1bmRlZmluZWQsXHJcbiAgICAgIG1heFByaWNlOiBzZWFyY2hQYXJhbXMuZ2V0KCdtYXhQcmljZScpID8gcGFyc2VGbG9hdChzZWFyY2hQYXJhbXMuZ2V0KCdtYXhQcmljZScpKSA6IHVuZGVmaW5lZCxcclxuICAgICAgYXZhaWxhYmxlU2xvdHM6IHNlYXJjaFBhcmFtcy5nZXQoJ2F2YWlsYWJsZVNsb3RzJykgIT09ICdmYWxzZScsIC8vIERlZmF1bHQgdG8gdHJ1ZVxyXG4gICAgICBvcmRlckJ5OiBzZWFyY2hQYXJhbXMuZ2V0KCdvcmRlckJ5JykgfHwgJ2NyZWF0ZWRfYXQnLFxyXG4gICAgICBhc2NlbmRpbmc6IHNlYXJjaFBhcmFtcy5nZXQoJ2FzY2VuZGluZycpID09PSAndHJ1ZScsXHJcbiAgICAgIGxpbWl0OiBzZWFyY2hQYXJhbXMuZ2V0KCdsaW1pdCcpID8gcGFyc2VJbnQoc2VhcmNoUGFyYW1zLmdldCgnbGltaXQnKSkgOiAxMCxcclxuICAgICAgb2Zmc2V0OiBzZWFyY2hQYXJhbXMuZ2V0KCdvZmZzZXQnKSA/IHBhcnNlSW50KHNlYXJjaFBhcmFtcy5nZXQoJ29mZnNldCcpKSA6IDBcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIFByenlnb3Rvd2FuaWUgemFweXRhbmlhXHJcbiAgICBsZXQgcXVlcnkgPSBzdXBhYmFzZUNsaWVudFxyXG4gICAgICAuZnJvbSgnZ3JvdXBfc3VicycpXHJcbiAgICAgIC5zZWxlY3QoYFxyXG4gICAgICAgICosXHJcbiAgICAgICAgc3Vic2NyaXB0aW9uX3BsYXRmb3JtcygqKSxcclxuICAgICAgICBncm91cHMoaWQsIG5hbWUsIGRlc2NyaXB0aW9uKSxcclxuICAgICAgICBvd25lcjpncm91cHMhaW5uZXIob3duZXJfaWQsIHVzZXJfcHJvZmlsZXMhaW5uZXIoaWQsIGRpc3BsYXlfbmFtZSwgYXZhdGFyX3VybCwgcmF0aW5nX2F2ZywgcmF0aW5nX2NvdW50LCB2ZXJpZmljYXRpb25fbGV2ZWwpKVxyXG4gICAgICBgKVxyXG4gICAgICAuZXEoJ3N0YXR1cycsICdhY3RpdmUnKTtcclxuICAgIFxyXG4gICAgLy8gRG9kYWogZmlsdHIgbmEgcGxhdGZvcm3EmVxyXG4gICAgaWYgKGZpbHRlcnMucGxhdGZvcm1JZCkge1xyXG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdwbGF0Zm9ybV9pZCcsIGZpbHRlcnMucGxhdGZvcm1JZCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIERvZGFqIGZpbHRyIG5hIGNlbsSZIG1pbmltYWxuxIVcclxuICAgIGlmIChmaWx0ZXJzLm1pblByaWNlICE9PSB1bmRlZmluZWQgJiYgIWlzTmFOKGZpbHRlcnMubWluUHJpY2UpKSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZ3RlKCdwcmljZV9wZXJfc2xvdCcsIGZpbHRlcnMubWluUHJpY2UpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBEb2RhaiBmaWx0ciBuYSBjZW7EmSBtYWtzeW1hbG7EhVxyXG4gICAgaWYgKGZpbHRlcnMubWF4UHJpY2UgIT09IHVuZGVmaW5lZCAmJiAhaXNOYU4oZmlsdGVycy5tYXhQcmljZSkpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5sdGUoJ3ByaWNlX3Blcl9zbG90JywgZmlsdGVycy5tYXhQcmljZSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEZpbHRydWogb2ZlcnR5IHR5bGtvIHogZG9zdMSZcG55bWkgbWllanNjYW1pXHJcbiAgICBpZiAoZmlsdGVycy5hdmFpbGFibGVTbG90cyAhPT0gZmFsc2UpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5ndCgnc2xvdHNfYXZhaWxhYmxlJywgMCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFNvcnRvd2FuaWVcclxuICAgIGNvbnN0IG9yZGVyQnkgPSBmaWx0ZXJzLm9yZGVyQnkgfHwgJ2NyZWF0ZWRfYXQnO1xyXG4gICAgY29uc3QgYXNjZW5kaW5nID0gZmlsdGVycy5hc2NlbmRpbmcgfHwgZmFsc2U7XHJcbiAgICBxdWVyeSA9IHF1ZXJ5Lm9yZGVyKG9yZGVyQnksIHsgYXNjZW5kaW5nIH0pO1xyXG4gICAgXHJcbiAgICAvLyBMaW1pdCBpIHBhZ2luYWNqYVxyXG4gICAgaWYgKGZpbHRlcnMubGltaXQpIHtcclxuICAgICAgcXVlcnkgPSBxdWVyeS5saW1pdChmaWx0ZXJzLmxpbWl0KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKGZpbHRlcnMub2Zmc2V0KSB7XHJcbiAgICAgIHF1ZXJ5ID0gcXVlcnkub2Zmc2V0KGZpbHRlcnMub2Zmc2V0KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gV3lrb25haiB6YXB5dGFuaWVcclxuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBzdWJzY3JpcHRpb24gb2ZmZXJzOicsIGVycm9yKTtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgICB7IGVycm9yOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZmV0Y2ggc3Vic2NyaXB0aW9uIG9mZmVycycsIGNvZGU6IGVycm9yLmNvZGUgfHwgJ3Vua25vd24nIH0sIFxyXG4gICAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKGRhdGEgfHwgW10pO1xyXG4gICAgfSBjYXRjaCAocXVlcnlFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFeGNlcHRpb24gZXhlY3V0aW5nIHF1ZXJ5OicsIHF1ZXJ5RXJyb3IpO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ0ZhaWxlZCB0byBleGVjdXRlIGRhdGFiYXNlIHF1ZXJ5JywgZGV0YWlsczogcXVlcnlFcnJvci5tZXNzYWdlIH0sIFxyXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBvZmZlcnM6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IGVycm9yOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZmV0Y2ggc3Vic2NyaXB0aW9uIG9mZmVycycsIGNvZGU6IGVycm9yLmNvZGUgfHwgJ3Vua25vd24nIH0sIFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogUE9TVCAvYXBpL29mZmVyc1xyXG4gKiBDcmVhdGUgYSBuZXcgc3Vic2NyaXB0aW9uIG9mZmVyXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIC8vIFZlcmlmeSB1c2VyIGlzIGF1dGhlbnRpY2F0ZWRcclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBjdXJyZW50VXNlcigpO1xyXG4gICAgaWYgKCF1c2VyKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiAnVW5hdXRob3JpemVkJyB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBHZXQgdXNlciBwcm9maWxlIHVzaW5nIGFkbWluIGNsaWVudFxyXG4gICAgY29uc3QgcHJvZmlsZSA9IGF3YWl0IGdldEN1cnJlbnRVc2VyUHJvZmlsZSgpO1xyXG4gICAgaWYgKCFwcm9maWxlKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiAnVXNlciBwcm9maWxlIG5vdCBmb3VuZCcgfSxcclxuICAgICAgICB7IHN0YXR1czogNDA0IH1cclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gUGFyc2UgcmVxdWVzdCBib2R5XHJcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XHJcbiAgICBcclxuICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xyXG4gICAgY29uc3QgcmVxdWlyZWRGaWVsZHMgPSBbJ2dyb3VwSWQnLCAncGxhdGZvcm1JZCcsICdzbG90c1RvdGFsJywgJ3ByaWNlUGVyU2xvdCcsICdhY2Nlc3NJbnN0cnVjdGlvbnMnXTtcclxuICAgIGZvciAoY29uc3QgZmllbGQgb2YgcmVxdWlyZWRGaWVsZHMpIHtcclxuICAgICAgaWYgKCFib2R5W2ZpZWxkXSkge1xyXG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICAgIHsgZXJyb3I6IGBNaXNzaW5nIHJlcXVpcmVkIGZpZWxkOiAke2ZpZWxkfWAgfSxcclxuICAgICAgICAgIHsgc3RhdHVzOiA0MDAgfVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gVmFsaWRhdGUgbnVtZXJpYyBmaWVsZHNcclxuICAgIGlmIChpc05hTihwYXJzZUZsb2F0KGJvZHkucHJpY2VQZXJTbG90KSkgfHwgcGFyc2VGbG9hdChib2R5LnByaWNlUGVyU2xvdCkgPD0gMCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ1ByaWNlIHBlciBzbG90IG11c3QgYmUgYSBwb3NpdGl2ZSBudW1iZXInIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihib2R5LnNsb3RzVG90YWwpIHx8IGJvZHkuc2xvdHNUb3RhbCA8PSAwKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiAnU2xvdHMgdG90YWwgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXInIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFByZXBhcmUgdGhlIG9mZmVyIGRhdGFcclxuICAgIGNvbnN0IG9mZmVyRGF0YSA9IHtcclxuICAgICAgZ3JvdXBfaWQ6IGJvZHkuZ3JvdXBJZCxcclxuICAgICAgcGxhdGZvcm1faWQ6IGJvZHkucGxhdGZvcm1JZCxcclxuICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcclxuICAgICAgc2xvdHNfdG90YWw6IGJvZHkuc2xvdHNUb3RhbCxcclxuICAgICAgc2xvdHNfYXZhaWxhYmxlOiBib2R5LnNsb3RzVG90YWwsXHJcbiAgICAgIHByaWNlX3Blcl9zbG90OiBib2R5LnByaWNlUGVyU2xvdCxcclxuICAgICAgY3VycmVuY3k6IGJvZHkuY3VycmVuY3kgfHwgJ1BMTicsXHJcbiAgICAgIGluc3RhbnRfYWNjZXNzOiB0cnVlIC8vIEFsbCBvZmZlcnMgbm93IGhhdmUgaW5zdGFudCBhY2Nlc3NcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIFZlcmlmeSBpZiB1c2VyIG93bnMgdGhlIGdyb3VwIHVzaW5nIGFkbWluIGNsaWVudFxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBkYXRhOiBncm91cERhdGEsIGVycm9yOiBncm91cEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgICAgLmZyb20oJ2dyb3VwcycpXHJcbiAgICAgICAgLnNlbGVjdCgnb3duZXJfaWQnKVxyXG4gICAgICAgIC5lcSgnaWQnLCBib2R5Lmdyb3VwSWQpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICBcclxuICAgICAgaWYgKGdyb3VwRXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgICB7IGVycm9yOiAnR3JvdXAgbm90IGZvdW5kIG9yIHlvdSBkbyBub3QgaGF2ZSBwZXJtaXNzaW9uJywgZGV0YWlsczogZ3JvdXBFcnJvci5tZXNzYWdlIH0sXHJcbiAgICAgICAgICB7IHN0YXR1czogNDAzIH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiAoZ3JvdXBEYXRhLm93bmVyX2lkICE9PSBwcm9maWxlLmlkKSB7XHJcbiAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgICAgeyBlcnJvcjogJ1lvdSBkbyBub3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGNyZWF0ZSBvZmZlcnMgZm9yIHRoaXMgZ3JvdXAnIH0sXHJcbiAgICAgICAgICB7IHN0YXR1czogNDAzIH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChncm91cENoZWNrRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2hlY2tpbmcgZ3JvdXAgb3duZXJzaGlwOicsIGdyb3VwQ2hlY2tFcnJvcik7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIHZlcmlmeSBncm91cCBvd25lcnNoaXAnLCBkZXRhaWxzOiBncm91cENoZWNrRXJyb3IubWVzc2FnZSB9LFxyXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBDcmVhdGUgb2ZmZXIgd2l0aCBhZG1pbiBjbGllbnRcclxuICAgIGxldCBjcmVhdGVkT2ZmZXI7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgICAgLmZyb20oJ2dyb3VwX3N1YnMnKVxyXG4gICAgICAgIC5pbnNlcnQob2ZmZXJEYXRhKVxyXG4gICAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuICAgICAgXHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNyZWF0aW5nIG9mZmVyOicsIGVycm9yKTtcclxuICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgICB7IGVycm9yOiBlcnJvci5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gY3JlYXRlIHN1YnNjcmlwdGlvbiBvZmZlcicsIGNvZGU6IGVycm9yLmNvZGUgfSxcclxuICAgICAgICAgIHsgc3RhdHVzOiA1MDAgfVxyXG4gICAgICAgICk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGNyZWF0ZWRPZmZlciA9IGRhdGE7XHJcbiAgICB9IGNhdGNoIChjcmVhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFeGNlcHRpb24gY3JlYXRpbmcgb2ZmZXI6JywgY3JlYXRlRXJyb3IpO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ0V4Y2VwdGlvbiB3aGlsZSBjcmVhdGluZyBvZmZlcicsIGRldGFpbHM6IGNyZWF0ZUVycm9yLm1lc3NhZ2UgfSxcclxuICAgICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gQ2hlY2sgcmVzdWx0XHJcbiAgICBpZiAoIWNyZWF0ZWRPZmZlciB8fCAhY3JlYXRlZE9mZmVyLmlkKSB7XHJcbiAgICAgIGNvbnNvbGUud2FybignT2ZmZXIgY3JlYXRpb24gcmVzcG9uc2UgbWlzc2luZyBJRCcpO1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgICAgeyBlcnJvcjogJ09mZmVyIHdhcyBjcmVhdGVkIGJ1dCByZXR1cm5lZCBpbnZhbGlkIGRhdGEnIH0sXHJcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFN0b3JlIGFjY2VzcyBpbnN0cnVjdGlvbnNcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgZXJyb3I6IGluc3RydWN0aW9uc0Vycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgICAgLmZyb20oJ2FjY2Vzc19pbnN0cnVjdGlvbnMnKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgZ3JvdXBfc3ViX2lkOiBjcmVhdGVkT2ZmZXIuaWQsXHJcbiAgICAgICAgICBpbnN0cnVjdGlvbnM6IGJvZHkuYWNjZXNzSW5zdHJ1Y3Rpb25zLFxyXG4gICAgICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAoaW5zdHJ1Y3Rpb25zRXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc2F2ZSBhY2Nlc3MgaW5zdHJ1Y3Rpb25zOicsIGluc3RydWN0aW9uc0Vycm9yKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoaW5zdHJ1Y3Rpb25zRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc2F2aW5nIGFjY2VzcyBpbnN0cnVjdGlvbnM6JywgaW5zdHJ1Y3Rpb25zRXJyb3IpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oY3JlYXRlZE9mZmVyLCB7IHN0YXR1czogMjAxIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyBvZmZlcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXHJcbiAgICAgIHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBjcmVhdGUgc3Vic2NyaXB0aW9uIG9mZmVyJyB9LCBcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApO1xyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJkeW5hbWljIiwiTmV4dFJlc3BvbnNlIiwiY3VycmVudFVzZXIiLCJnZXRDdXJyZW50VXNlclByb2ZpbGUiLCJzdXBhYmFzZUFkbWluIiwiR0VUIiwicmVxdWVzdCIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsInN1cGFiYXNlQ2xpZW50IiwiZmlsdGVycyIsInBsYXRmb3JtSWQiLCJnZXQiLCJ1bmRlZmluZWQiLCJtaW5QcmljZSIsInBhcnNlRmxvYXQiLCJtYXhQcmljZSIsImF2YWlsYWJsZVNsb3RzIiwib3JkZXJCeSIsImFzY2VuZGluZyIsImxpbWl0IiwicGFyc2VJbnQiLCJvZmZzZXQiLCJxdWVyeSIsImZyb20iLCJzZWxlY3QiLCJlcSIsImlzTmFOIiwiZ3RlIiwibHRlIiwiZ3QiLCJvcmRlciIsImRhdGEiLCJlcnJvciIsImNvbnNvbGUiLCJqc29uIiwibWVzc2FnZSIsImNvZGUiLCJzdGF0dXMiLCJxdWVyeUVycm9yIiwiZGV0YWlscyIsIlBPU1QiLCJ1c2VyIiwicHJvZmlsZSIsImJvZHkiLCJyZXF1aXJlZEZpZWxkcyIsImZpZWxkIiwicHJpY2VQZXJTbG90IiwiTnVtYmVyIiwiaXNJbnRlZ2VyIiwic2xvdHNUb3RhbCIsIm9mZmVyRGF0YSIsImdyb3VwX2lkIiwiZ3JvdXBJZCIsInBsYXRmb3JtX2lkIiwic2xvdHNfdG90YWwiLCJzbG90c19hdmFpbGFibGUiLCJwcmljZV9wZXJfc2xvdCIsImN1cnJlbmN5IiwiaW5zdGFudF9hY2Nlc3MiLCJncm91cERhdGEiLCJncm91cEVycm9yIiwic2luZ2xlIiwib3duZXJfaWQiLCJpZCIsImdyb3VwQ2hlY2tFcnJvciIsImNyZWF0ZWRPZmZlciIsImluc2VydCIsImNyZWF0ZUVycm9yIiwid2FybiIsImluc3RydWN0aW9uc0Vycm9yIiwiZ3JvdXBfc3ViX2lkIiwiaW5zdHJ1Y3Rpb25zIiwiYWNjZXNzSW5zdHJ1Y3Rpb25zIiwidXBkYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/offers/route.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/auth-service.js":
/*!*********************************!*\
  !*** ./src/lib/auth-service.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getCurrentUserProfile: () => (/* binding */ getCurrentUserProfile),\n/* harmony export */   getOrCreateUserProfile: () => (/* binding */ getOrCreateUserProfile),\n/* harmony export */   updateUserProfile: () => (/* binding */ updateUserProfile)\n/* harmony export */ });\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(rsc)/./node_modules/@clerk/nextjs/dist/esm/app-router/server/currentUser.js\");\n/* harmony import */ var _supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabase-admin-client */ \"(rsc)/./src/lib/supabase-admin-client.js\");\n/* harmony import */ var _supabase_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./supabase-server */ \"(rsc)/./src/lib/supabase-server.js\");\n\n\n\n/**\r\n * Pobiera aktualny profil użytkownika z bazy danych\r\n */ async function getCurrentUserProfile() {\n    try {\n        // Pobierz użytkownika z Clerk\n        const user = await (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_2__.currentUser)();\n        if (!user) {\n            console.log(\"No authenticated user found\");\n            return null;\n        }\n        console.log(\"Getting profile for user:\", user.id);\n        // Próbujemy najpierw z supabaseAdmin, który zawsze powinien działać\n        let profile = null;\n        try {\n            const { data, error } = await _supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"user_profiles\").select(\"*\").eq(\"external_auth_id\", user.id).single();\n            if (!error) {\n                console.log(\"Found profile using admin client\");\n                profile = data;\n            } else if (error.code !== \"PGRST116\") {\n                console.error(\"Error fetching user profile with admin client:\", error);\n            }\n        } catch (adminError) {\n            console.error(\"Exception using admin client:\", adminError);\n        }\n        // Jeśli znaleźliśmy profil, zwróć go\n        if (profile) {\n            return profile;\n        }\n        // Próbujemy z createServerSupabaseClient\n        if (!profile) {\n            try {\n                const supabaseClient = await (0,_supabase_server__WEBPACK_IMPORTED_MODULE_1__.createServerSupabaseClient)();\n                const { data, error } = await supabaseClient.from(\"user_profiles\").select(\"*\").eq(\"external_auth_id\", user.id).single();\n                if (!error) {\n                    console.log(\"Found profile using server client\");\n                    profile = data;\n                } else if (error.code !== \"PGRST116\") {\n                    console.error(\"Error fetching user profile with server client:\", error);\n                }\n            } catch (serverError) {\n                console.error(\"Exception using server client:\", serverError);\n            }\n        }\n        // Jeśli wciąż nie znaleźliśmy profilu, zwracamy null\n        if (!profile) {\n            console.log(\"Profile not found for user:\", user.id);\n        }\n        return profile;\n    } catch (error) {\n        console.error(\"Exception in getCurrentUserProfile:\", error);\n        return null;\n    }\n}\n/**\r\n * Pobiera profil użytkownika Clerk i tworzy go jeśli nie istnieje\r\n */ async function getOrCreateUserProfile() {\n    try {\n        const user = await (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_2__.currentUser)();\n        if (!user) {\n            console.log(\"No authenticated user found\");\n            return null;\n        }\n        console.log(\"Getting or creating profile for user:\", user.id);\n        // Próba pobrania istniejącego profilu\n        const userProfile = await getCurrentUserProfile();\n        // Jeśli profil istnieje, zwróć go\n        if (userProfile) {\n            return userProfile;\n        }\n        console.log(\"Creating new profile for user:\", user.id);\n        // Próbujemy pobrać e-mail i dane\n        let email = \"\";\n        let firstName = \"\";\n        let lastName = \"\";\n        let imageUrl = null;\n        if (user.emailAddresses && user.emailAddresses.length > 0) {\n            email = user.emailAddresses[0].emailAddress;\n        }\n        firstName = user.firstName || \"\";\n        lastName = user.lastName || \"\";\n        imageUrl = user.imageUrl || null;\n        // W przeciwnym razie utwórz nowy profil\n        const newProfile = {\n            external_auth_id: user.id,\n            display_name: firstName ? `${firstName} ${lastName || \"\"}`.trim() : user.username || \"Nowy użytkownik\",\n            email: email,\n            phone_number: user.phoneNumbers && user.phoneNumbers[0]?.phoneNumber || null,\n            profile_type: \"both\",\n            verification_level: \"basic\",\n            bio: \"\",\n            avatar_url: imageUrl,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString()\n        };\n        // Użyj supabaseAdmin, który ma uprawnienia service_role i pomija RLS\n        const { data: createdProfile, error: createError } = await _supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"user_profiles\").insert([\n            newProfile\n        ]).select().single();\n        if (createError) {\n            console.error(\"Error creating user profile with supabaseAdmin:\", createError);\n            return null;\n        }\n        console.log(\"Successfully created profile for user:\", user.id);\n        return createdProfile;\n    } catch (error) {\n        console.error(\"Error in getOrCreateUserProfile:\", error);\n        return null;\n    }\n}\n/**\r\n * Aktualizuje profil użytkownika\r\n */ async function updateUserProfile(userId, profileData) {\n    try {\n        if (!userId) {\n            throw new Error(\"User ID is required\");\n        }\n        const { data, error } = await _supabase_admin_client__WEBPACK_IMPORTED_MODULE_0__[\"default\"].from(\"user_profiles\").update(profileData).eq(\"id\", userId).select().single();\n        if (error) {\n            console.error(\"Error updating user profile:\", error);\n            throw error;\n        }\n        return data;\n    } catch (error) {\n        console.error(\"Exception in updateUserProfile:\", error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0x3QyxNQUFNLENBQUNGLGFBQ1BwQyxFQUFFLENBQUMsTUFBTW1DLFFBQ1RwQyxNQUFNLEdBQ05FLE1BQU07UUFFVCxJQUFJSixPQUFPO1lBQ1RMLFFBQVFLLEtBQUssQ0FBQyxnQ0FBZ0NBO1lBQzlDLE1BQU1BO1FBQ1I7UUFFQSxPQUFPRDtJQUNULEVBQUUsT0FBT0MsT0FBTztRQUNkTCxRQUFRSyxLQUFLLENBQUMsbUNBQW1DQTtRQUNqRCxNQUFNQTtJQUNSO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ncm91cHNoYXJlLXByb2plY3QvLi9zcmMvbGliL2F1dGgtc2VydmljZS5qcz9lOGVjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGN1cnJlbnRVc2VyLCBjbGVya0NsaWVudCB9IGZyb20gJ0BjbGVyay9uZXh0anMvc2VydmVyJztcclxuaW1wb3J0IHN1cGFiYXNlQWRtaW4gZnJvbSAnLi9zdXBhYmFzZS1hZG1pbi1jbGllbnQnO1xyXG5pbXBvcnQgeyBjcmVhdGVTZXJ2ZXJTdXBhYmFzZUNsaWVudCB9IGZyb20gJy4vc3VwYWJhc2Utc2VydmVyJztcclxuXHJcbi8qKlxyXG4gKiBQb2JpZXJhIGFrdHVhbG55IHByb2ZpbCB1xbx5dGtvd25pa2EgeiBiYXp5IGRhbnljaFxyXG4gKi9cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEN1cnJlbnRVc2VyUHJvZmlsZSgpIHtcclxuICB0cnkge1xyXG4gICAgLy8gUG9iaWVyeiB1xbx5dGtvd25pa2EgeiBDbGVya1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGN1cnJlbnRVc2VyKCk7XHJcbiAgICBcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICBjb25zb2xlLmxvZygnTm8gYXV0aGVudGljYXRlZCB1c2VyIGZvdW5kJyk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZygnR2V0dGluZyBwcm9maWxlIGZvciB1c2VyOicsIHVzZXIuaWQpO1xyXG4gICAgXHJcbiAgICAvLyBQcsOzYnVqZW15IG5hanBpZXJ3IHogc3VwYWJhc2VBZG1pbiwga3TDs3J5IHphd3N6ZSBwb3dpbmllbiBkemlhxYJhxIdcclxuICAgIGxldCBwcm9maWxlID0gbnVsbDtcclxuICAgIFxyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxyXG4gICAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgICAuc2VsZWN0KCcqJylcclxuICAgICAgICAuZXEoJ2V4dGVybmFsX2F1dGhfaWQnLCB1c2VyLmlkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuICAgICAgXHJcbiAgICAgIGlmICghZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnRm91bmQgcHJvZmlsZSB1c2luZyBhZG1pbiBjbGllbnQnKTtcclxuICAgICAgICBwcm9maWxlID0gZGF0YTtcclxuICAgICAgfSBlbHNlIGlmIChlcnJvci5jb2RlICE9PSAnUEdSU1QxMTYnKSB7IC8vIE9ubHkgbG9nIG5vbi1ub3QtZm91bmQgZXJyb3JzXHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgdXNlciBwcm9maWxlIHdpdGggYWRtaW4gY2xpZW50OicsIGVycm9yKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoYWRtaW5FcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFeGNlcHRpb24gdXNpbmcgYWRtaW4gY2xpZW50OicsIGFkbWluRXJyb3IpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBKZcWbbGkgem5hbGXFumxpxZtteSBwcm9maWwsIHp3csOzxIcgZ29cclxuICAgIGlmIChwcm9maWxlKSB7XHJcbiAgICAgIHJldHVybiBwcm9maWxlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBQcsOzYnVqZW15IHogY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnRcclxuICAgIGlmICghcHJvZmlsZSkge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHN1cGFiYXNlQ2xpZW50ID0gYXdhaXQgY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQoKTtcclxuICAgICAgICBcclxuICAgICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUNsaWVudFxyXG4gICAgICAgICAgLmZyb20oJ3VzZXJfcHJvZmlsZXMnKVxyXG4gICAgICAgICAgLnNlbGVjdCgnKicpXHJcbiAgICAgICAgICAuZXEoJ2V4dGVybmFsX2F1dGhfaWQnLCB1c2VyLmlkKVxyXG4gICAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgaWYgKCFlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ0ZvdW5kIHByb2ZpbGUgdXNpbmcgc2VydmVyIGNsaWVudCcpO1xyXG4gICAgICAgICAgcHJvZmlsZSA9IGRhdGE7XHJcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvci5jb2RlICE9PSAnUEdSU1QxMTYnKSB7IC8vIE9ubHkgbG9nIG5vbi1ub3QtZm91bmQgZXJyb3JzXHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyB1c2VyIHByb2ZpbGUgd2l0aCBzZXJ2ZXIgY2xpZW50OicsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gY2F0Y2ggKHNlcnZlckVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXhjZXB0aW9uIHVzaW5nIHNlcnZlciBjbGllbnQ6Jywgc2VydmVyRXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIEplxZtsaSB3Y2nEhcW8IG5pZSB6bmFsZcW6bGnFm215IHByb2ZpbHUsIHp3cmFjYW15IG51bGxcclxuICAgIGlmICghcHJvZmlsZSkge1xyXG4gICAgICBjb25zb2xlLmxvZygnUHJvZmlsZSBub3QgZm91bmQgZm9yIHVzZXI6JywgdXNlci5pZCk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIHJldHVybiBwcm9maWxlO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFeGNlcHRpb24gaW4gZ2V0Q3VycmVudFVzZXJQcm9maWxlOicsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIFBvYmllcmEgcHJvZmlsIHXFvHl0a293bmlrYSBDbGVyayBpIHR3b3J6eSBnbyBqZcWbbGkgbmllIGlzdG5pZWplXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0T3JDcmVhdGVVc2VyUHJvZmlsZSgpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgdXNlciA9IGF3YWl0IGN1cnJlbnRVc2VyKCk7XHJcbiAgICBcclxuICAgIGlmICghdXNlcikge1xyXG4gICAgICBjb25zb2xlLmxvZygnTm8gYXV0aGVudGljYXRlZCB1c2VyIGZvdW5kJyk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZygnR2V0dGluZyBvciBjcmVhdGluZyBwcm9maWxlIGZvciB1c2VyOicsIHVzZXIuaWQpO1xyXG4gICAgXHJcbiAgICAvLyBQcsOzYmEgcG9icmFuaWEgaXN0bmllasSFY2VnbyBwcm9maWx1XHJcbiAgICBjb25zdCB1c2VyUHJvZmlsZSA9IGF3YWl0IGdldEN1cnJlbnRVc2VyUHJvZmlsZSgpO1xyXG4gICAgXHJcbiAgICAvLyBKZcWbbGkgcHJvZmlsIGlzdG5pZWplLCB6d3LDs8SHIGdvXHJcbiAgICBpZiAodXNlclByb2ZpbGUpIHtcclxuICAgICAgcmV0dXJuIHVzZXJQcm9maWxlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZygnQ3JlYXRpbmcgbmV3IHByb2ZpbGUgZm9yIHVzZXI6JywgdXNlci5pZCk7XHJcbiAgICBcclxuICAgIC8vIFByw7NidWplbXkgcG9icmHEhyBlLW1haWwgaSBkYW5lXHJcbiAgICBsZXQgZW1haWwgPSAnJztcclxuICAgIGxldCBmaXJzdE5hbWUgPSAnJztcclxuICAgIGxldCBsYXN0TmFtZSA9ICcnO1xyXG4gICAgbGV0IGltYWdlVXJsID0gbnVsbDtcclxuICAgIFxyXG4gICAgaWYgKHVzZXIuZW1haWxBZGRyZXNzZXMgJiYgdXNlci5lbWFpbEFkZHJlc3Nlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIGVtYWlsID0gdXNlci5lbWFpbEFkZHJlc3Nlc1swXS5lbWFpbEFkZHJlc3M7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZpcnN0TmFtZSA9IHVzZXIuZmlyc3ROYW1lIHx8ICcnO1xyXG4gICAgbGFzdE5hbWUgPSB1c2VyLmxhc3ROYW1lIHx8ICcnO1xyXG4gICAgaW1hZ2VVcmwgPSB1c2VyLmltYWdlVXJsIHx8IG51bGw7XHJcbiAgICBcclxuICAgIC8vIFcgcHJ6ZWNpd255bSByYXppZSB1dHfDs3J6IG5vd3kgcHJvZmlsXHJcbiAgICBjb25zdCBuZXdQcm9maWxlID0ge1xyXG4gICAgICBleHRlcm5hbF9hdXRoX2lkOiB1c2VyLmlkLFxyXG4gICAgICBkaXNwbGF5X25hbWU6IGZpcnN0TmFtZSBcclxuICAgICAgICA/IGAke2ZpcnN0TmFtZX0gJHtsYXN0TmFtZSB8fCAnJ31gLnRyaW0oKSBcclxuICAgICAgICA6ICh1c2VyLnVzZXJuYW1lIHx8ICdOb3d5IHXFvHl0a293bmlrJyksXHJcbiAgICAgIGVtYWlsOiBlbWFpbCxcclxuICAgICAgcGhvbmVfbnVtYmVyOiB1c2VyLnBob25lTnVtYmVycyAmJiB1c2VyLnBob25lTnVtYmVyc1swXT8ucGhvbmVOdW1iZXIgfHwgbnVsbCxcclxuICAgICAgcHJvZmlsZV90eXBlOiAnYm90aCcsXHJcbiAgICAgIHZlcmlmaWNhdGlvbl9sZXZlbDogJ2Jhc2ljJyxcclxuICAgICAgYmlvOiAnJyxcclxuICAgICAgYXZhdGFyX3VybDogaW1hZ2VVcmwsXHJcbiAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgdXBkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBVxbx5aiBzdXBhYmFzZUFkbWluLCBrdMOzcnkgbWEgdXByYXduaWVuaWEgc2VydmljZV9yb2xlIGkgcG9taWphIFJMU1xyXG4gICAgY29uc3QgeyBkYXRhOiBjcmVhdGVkUHJvZmlsZSwgZXJyb3I6IGNyZWF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgLmluc2VydChbbmV3UHJvZmlsZV0pXHJcbiAgICAgIC5zZWxlY3QoKVxyXG4gICAgICAuc2luZ2xlKCk7XHJcbiAgICBcclxuICAgIGlmIChjcmVhdGVFcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjcmVhdGluZyB1c2VyIHByb2ZpbGUgd2l0aCBzdXBhYmFzZUFkbWluOicsIGNyZWF0ZUVycm9yKTtcclxuICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnNvbGUubG9nKCdTdWNjZXNzZnVsbHkgY3JlYXRlZCBwcm9maWxlIGZvciB1c2VyOicsIHVzZXIuaWQpO1xyXG4gICAgcmV0dXJuIGNyZWF0ZWRQcm9maWxlO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiBnZXRPckNyZWF0ZVVzZXJQcm9maWxlOicsIGVycm9yKTtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIEFrdHVhbGl6dWplIHByb2ZpbCB1xbx5dGtvd25pa2FcclxuICovXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVVc2VyUHJvZmlsZSh1c2VySWQsIHByb2ZpbGVEYXRhKSB7XHJcbiAgdHJ5IHtcclxuICAgIGlmICghdXNlcklkKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcignVXNlciBJRCBpcyByZXF1aXJlZCcpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXHJcbiAgICAgIC5mcm9tKCd1c2VyX3Byb2ZpbGVzJylcclxuICAgICAgLnVwZGF0ZShwcm9maWxlRGF0YSlcclxuICAgICAgLmVxKCdpZCcsIHVzZXJJZClcclxuICAgICAgLnNlbGVjdCgpXHJcbiAgICAgIC5zaW5nbGUoKTtcclxuICAgIFxyXG4gICAgaWYgKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHVzZXIgcHJvZmlsZTonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gZGF0YTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXhjZXB0aW9uIGluIHVwZGF0ZVVzZXJQcm9maWxlOicsIGVycm9yKTtcclxuICAgIHRocm93IGVycm9yO1xyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJjdXJyZW50VXNlciIsImNsZXJrQ2xpZW50Iiwic3VwYWJhc2VBZG1pbiIsImNyZWF0ZVNlcnZlclN1cGFiYXNlQ2xpZW50IiwiZ2V0Q3VycmVudFVzZXJQcm9maWxlIiwidXNlciIsImNvbnNvbGUiLCJsb2ciLCJpZCIsInByb2ZpbGUiLCJkYXRhIiwiZXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJzaW5nbGUiLCJjb2RlIiwiYWRtaW5FcnJvciIsInN1cGFiYXNlQ2xpZW50Iiwic2VydmVyRXJyb3IiLCJnZXRPckNyZWF0ZVVzZXJQcm9maWxlIiwidXNlclByb2ZpbGUiLCJlbWFpbCIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwiaW1hZ2VVcmwiLCJlbWFpbEFkZHJlc3NlcyIsImxlbmd0aCIsImVtYWlsQWRkcmVzcyIsIm5ld1Byb2ZpbGUiLCJleHRlcm5hbF9hdXRoX2lkIiwiZGlzcGxheV9uYW1lIiwidHJpbSIsInVzZXJuYW1lIiwicGhvbmVfbnVtYmVyIiwicGhvbmVOdW1iZXJzIiwicGhvbmVOdW1iZXIiLCJwcm9maWxlX3R5cGUiLCJ2ZXJpZmljYXRpb25fbGV2ZWwiLCJiaW8iLCJhdmF0YXJfdXJsIiwiY3JlYXRlZF9hdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInVwZGF0ZWRfYXQiLCJjcmVhdGVkUHJvZmlsZSIsImNyZWF0ZUVycm9yIiwiaW5zZXJ0IiwidXBkYXRlVXNlclByb2ZpbGUiLCJ1c2VySWQiLCJwcm9maWxlRGF0YSIsIkVycm9yIiwidXBkYXRlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/auth-service.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabase-admin-client.js":
/*!******************************************!*\
  !*** ./src/lib/supabase-admin-client.js ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst supabaseUrl = \"https://twiarwghktzljergqfsm.supabase.co\";\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n// Sprawdź zmienne środowiskowe\nif (!supabaseUrl || !supabaseServiceKey) {\n    console.error(\"Missing Supabase environment variables for admin client\");\n    console.log(\"URL:\", supabaseUrl?.substring(0, 10) + \"...\");\n    console.log(\"Service key defined:\", !!supabaseServiceKey);\n}\n// Utwórz klienta admin\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey, {\n    auth: {\n        autoRefreshToken: false,\n        persistSession: false\n    },\n    global: {\n        headers: {\n            \"x-supabase-bypass-rls\": \"true\"\n        }\n    }\n});\n// Sprawdź czy klient ma metodę from()\nif (!supabaseAdmin || typeof supabaseAdmin.from !== \"function\") {\n    console.error(\"supabaseAdmin client is not properly initialized\");\n    console.log(\"supabaseAdmin:\", supabaseAdmin ? \"defined\" : \"undefined\");\n    console.log(\"from method:\", supabaseAdmin && typeof supabaseAdmin.from === \"function\" ? \"exists\" : \"missing\");\n}\n// Wykonaj test połączenia\nconst testConnection = async ()=>{\n    try {\n        const { data, error } = await supabaseAdmin.from(\"user_profiles\").select(\"count(*)\", {\n            count: \"exact\",\n            head: true\n        });\n        if (error) {\n            console.error(\"Admin client test failed:\", error);\n            return false;\n        }\n        console.log(\"Admin client test successful\");\n        return true;\n    } catch (err) {\n        console.error(\"Admin client test exception:\", err);\n        return false;\n    }\n};\n// Wywołaj test, ale nie czekaj na jego zakończenie\ntestConnection();\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (supabaseAdmin);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlLWFkbWluLWNsaWVudC5qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFxRDtBQUVyRCxNQUFNQyxjQUFjQywwQ0FBb0M7QUFDeEQsTUFBTUcscUJBQXFCSCxRQUFRQyxHQUFHLENBQUNHLHlCQUF5QjtBQUVoRSwrQkFBK0I7QUFDL0IsSUFBSSxDQUFDTCxlQUFlLENBQUNJLG9CQUFvQjtJQUN2Q0UsUUFBUUMsS0FBSyxDQUFDO0lBQ2RELFFBQVFFLEdBQUcsQ0FBQyxRQUFRUixhQUFhUyxVQUFVLEdBQUcsTUFBTTtJQUNwREgsUUFBUUUsR0FBRyxDQUFDLHdCQUF3QixDQUFDLENBQUNKO0FBQ3hDO0FBRUEsdUJBQXVCO0FBQ3ZCLE1BQU1NLGdCQUFnQlgsbUVBQVlBLENBQUNDLGFBQWFJLG9CQUFvQjtJQUNsRU8sTUFBTTtRQUNKQyxrQkFBa0I7UUFDbEJDLGdCQUFnQjtJQUNsQjtJQUNBQyxRQUFRO1FBQ05DLFNBQVM7WUFDUCx5QkFBeUI7UUFDM0I7SUFDRjtBQUNGO0FBRUEsc0NBQXNDO0FBQ3RDLElBQUksQ0FBQ0wsaUJBQWlCLE9BQU9BLGNBQWNNLElBQUksS0FBSyxZQUFZO0lBQzlEVixRQUFRQyxLQUFLLENBQUM7SUFDZEQsUUFBUUUsR0FBRyxDQUFDLGtCQUFrQkUsZ0JBQWdCLFlBQVk7SUFDMURKLFFBQVFFLEdBQUcsQ0FBQyxnQkFBZ0JFLGlCQUFpQixPQUFPQSxjQUFjTSxJQUFJLEtBQUssYUFBYSxXQUFXO0FBQ3JHO0FBRUEsMEJBQTBCO0FBQzFCLE1BQU1DLGlCQUFpQjtJQUNyQixJQUFJO1FBQ0YsTUFBTSxFQUFFQyxJQUFJLEVBQUVYLEtBQUssRUFBRSxHQUFHLE1BQU1HLGNBQWNNLElBQUksQ0FBQyxpQkFBaUJHLE1BQU0sQ0FBQyxZQUFZO1lBQUVDLE9BQU87WUFBU0MsTUFBTTtRQUFLO1FBRWxILElBQUlkLE9BQU87WUFDVEQsUUFBUUMsS0FBSyxDQUFDLDZCQUE2QkE7WUFDM0MsT0FBTztRQUNUO1FBRUFELFFBQVFFLEdBQUcsQ0FBQztRQUNaLE9BQU87SUFDVCxFQUFFLE9BQU9jLEtBQUs7UUFDWmhCLFFBQVFDLEtBQUssQ0FBQyxnQ0FBZ0NlO1FBQzlDLE9BQU87SUFDVDtBQUNGO0FBRUEsbURBQW1EO0FBQ25ETDtBQUVBLGlFQUFlUCxhQUFhQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ3JvdXBzaGFyZS1wcm9qZWN0Ly4vc3JjL2xpYi9zdXBhYmFzZS1hZG1pbi1jbGllbnQuanM/OWFkOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5cclxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XHJcbmNvbnN0IHN1cGFiYXNlU2VydmljZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVk7XHJcblxyXG4vLyBTcHJhd2TFuiB6bWllbm5lIMWbcm9kb3dpc2tvd2VcclxuaWYgKCFzdXBhYmFzZVVybCB8fCAhc3VwYWJhc2VTZXJ2aWNlS2V5KSB7XHJcbiAgY29uc29sZS5lcnJvcignTWlzc2luZyBTdXBhYmFzZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZm9yIGFkbWluIGNsaWVudCcpO1xyXG4gIGNvbnNvbGUubG9nKCdVUkw6Jywgc3VwYWJhc2VVcmw/LnN1YnN0cmluZygwLCAxMCkgKyAnLi4uJyk7XHJcbiAgY29uc29sZS5sb2coJ1NlcnZpY2Uga2V5IGRlZmluZWQ6JywgISFzdXBhYmFzZVNlcnZpY2VLZXkpO1xyXG59XHJcblxyXG4vLyBVdHfDs3J6IGtsaWVudGEgYWRtaW5cclxuY29uc3Qgc3VwYWJhc2VBZG1pbiA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VTZXJ2aWNlS2V5LCB7XHJcbiAgYXV0aDoge1xyXG4gICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXHJcbiAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2VcclxuICB9LFxyXG4gIGdsb2JhbDoge1xyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICAneC1zdXBhYmFzZS1ieXBhc3MtcmxzJzogJ3RydWUnXHJcbiAgICB9XHJcbiAgfVxyXG59KTtcclxuXHJcbi8vIFNwcmF3ZMW6IGN6eSBrbGllbnQgbWEgbWV0b2TEmSBmcm9tKClcclxuaWYgKCFzdXBhYmFzZUFkbWluIHx8IHR5cGVvZiBzdXBhYmFzZUFkbWluLmZyb20gIT09ICdmdW5jdGlvbicpIHtcclxuICBjb25zb2xlLmVycm9yKCdzdXBhYmFzZUFkbWluIGNsaWVudCBpcyBub3QgcHJvcGVybHkgaW5pdGlhbGl6ZWQnKTtcclxuICBjb25zb2xlLmxvZygnc3VwYWJhc2VBZG1pbjonLCBzdXBhYmFzZUFkbWluID8gJ2RlZmluZWQnIDogJ3VuZGVmaW5lZCcpO1xyXG4gIGNvbnNvbGUubG9nKCdmcm9tIG1ldGhvZDonLCBzdXBhYmFzZUFkbWluICYmIHR5cGVvZiBzdXBhYmFzZUFkbWluLmZyb20gPT09ICdmdW5jdGlvbicgPyAnZXhpc3RzJyA6ICdtaXNzaW5nJyk7XHJcbn1cclxuXHJcbi8vIFd5a29uYWogdGVzdCBwb8WCxIVjemVuaWFcclxuY29uc3QgdGVzdENvbm5lY3Rpb24gPSBhc3luYyAoKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW4uZnJvbSgndXNlcl9wcm9maWxlcycpLnNlbGVjdCgnY291bnQoKiknLCB7IGNvdW50OiAnZXhhY3QnLCBoZWFkOiB0cnVlIH0pO1xyXG4gICAgXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignQWRtaW4gY2xpZW50IHRlc3QgZmFpbGVkOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZygnQWRtaW4gY2xpZW50IHRlc3Qgc3VjY2Vzc2Z1bCcpO1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdBZG1pbiBjbGllbnQgdGVzdCBleGNlcHRpb246JywgZXJyKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn07XHJcblxyXG4vLyBXeXdvxYJhaiB0ZXN0LCBhbGUgbmllIGN6ZWthaiBuYSBqZWdvIHpha2/FhGN6ZW5pZVxyXG50ZXN0Q29ubmVjdGlvbigpO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgc3VwYWJhc2VBZG1pbjsiXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50Iiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VTZXJ2aWNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsImNvbnNvbGUiLCJlcnJvciIsImxvZyIsInN1YnN0cmluZyIsInN1cGFiYXNlQWRtaW4iLCJhdXRoIiwiYXV0b1JlZnJlc2hUb2tlbiIsInBlcnNpc3RTZXNzaW9uIiwiZ2xvYmFsIiwiaGVhZGVycyIsImZyb20iLCJ0ZXN0Q29ubmVjdGlvbiIsImRhdGEiLCJzZWxlY3QiLCJjb3VudCIsImhlYWQiLCJlcnIiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabase-admin-client.js\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabase-server.js":
/*!************************************!*\
  !*** ./src/lib/supabase-server.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createServerSupabaseClient: () => (/* binding */ createServerSupabaseClient)\n/* harmony export */ });\n/* harmony import */ var _clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @clerk/nextjs/server */ \"(rsc)/./node_modules/@clerk/nextjs/dist/esm/app-router/server/auth.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n// src/lib/supabase-server.js\n\n\nconst supabaseUrl = \"https://twiarwghktzljergqfsm.supabase.co\";\n// Obsługa obu możliwych nazw zmiennych\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_KEY || \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR3aWFyd2doa3R6bGplcmdxZnNtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwMzUxNzUsImV4cCI6MjA1OTYxMTE3NX0.EOGGJVUQeeAG__KyJA_xkIGUjWhTReGEDWa9JV6LZz8\";\n/**\r\n * Tworzy klienta Supabase dla użycia po stronie serwera z uwierzytelnianiem Clerk\r\n * \r\n * @returns {Promise<Object>} Klient Supabase\r\n */ async function createServerSupabaseClient() {\n    // Wyświetl informacje o dostępnych zmiennych środowiskowych\n    console.log(\"Environment variables check:\");\n    console.log(\"NEXT_PUBLIC_SUPABASE_URL exists:\", !!\"https://twiarwghktzljergqfsm.supabase.co\");\n    console.log(\"NEXT_PUBLIC_SUPABASE_KEY exists:\", !!process.env.NEXT_PUBLIC_SUPABASE_KEY);\n    console.log(\"NEXT_PUBLIC_SUPABASE_ANON_KEY exists:\", !!\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR3aWFyd2doa3R6bGplcmdxZnNtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwMzUxNzUsImV4cCI6MjA1OTYxMTE3NX0.EOGGJVUQeeAG__KyJA_xkIGUjWhTReGEDWa9JV6LZz8\");\n    if (!supabaseUrl || !supabaseAnonKey) {\n        console.error(\"Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_KEY/ANON_KEY\");\n        console.error(\"URL:\", \"https://twiarwghktzljergqfsm.supabase.co\"?.substring(0, 10) + \"...\");\n        console.error(\"KEY:\", process.env.NEXT_PUBLIC_SUPABASE_KEY || \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR3aWFyd2doa3R6bGplcmdxZnNtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwMzUxNzUsImV4cCI6MjA1OTYxMTE3NX0.EOGGJVUQeeAG__KyJA_xkIGUjWhTReGEDWa9JV6LZz8\" ? \"exists\" : 0);\n    }\n    try {\n        // Używamy auth() z Clerk, który jest dostępny po stronie serwera\n        const authObject = (0,_clerk_nextjs_server__WEBPACK_IMPORTED_MODULE_0__.auth)();\n        if (!authObject) {\n            console.log(\"No auth object available in createServerSupabaseClient\");\n            return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey);\n        }\n        return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey, {\n            auth: {\n                persistSession: false,\n                autoRefreshToken: false\n            },\n            global: {\n                headers: {\n                    \"x-clerk-auth-reason\": \"supabase-integration\"\n                }\n            },\n            async accessToken () {\n                try {\n                    // Pobieramy token bezpośrednio za pomocą api auth()\n                    return await authObject.getToken();\n                } catch (error) {\n                    console.error(\"Error getting token in createServerSupabaseClient:\", error);\n                    return null;\n                }\n            }\n        });\n    } catch (error) {\n        console.error(\"Error in createServerSupabaseClient:\", error);\n        return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlLXNlcnZlci5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSw2QkFBNkI7QUFDZTtBQUNTO0FBRXJELE1BQU1FLGNBQWNDLDBDQUFvQztBQUN4RCx1Q0FBdUM7QUFDdkMsTUFBTUcsa0JBQWtCSCxRQUFRQyxHQUFHLENBQUNHLHdCQUF3QixJQUFJSixrTkFBeUM7QUFFekc7Ozs7Q0FJQyxHQUNNLGVBQWVNO0lBQ3BCLDREQUE0RDtJQUM1REMsUUFBUUMsR0FBRyxDQUFDO0lBQ1pELFFBQVFDLEdBQUcsQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDUiwwQ0FBb0M7SUFDdEZPLFFBQVFDLEdBQUcsQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDUixRQUFRQyxHQUFHLENBQUNHLHdCQUF3QjtJQUN0RkcsUUFBUUMsR0FBRyxDQUFDLHlDQUF5QyxDQUFDLENBQUNSLGtOQUF5QztJQUVoRyxJQUFJLENBQUNELGVBQWUsQ0FBQ0ksaUJBQWlCO1FBQ3BDSSxRQUFRRSxLQUFLLENBQUM7UUFDZEYsUUFBUUUsS0FBSyxDQUFDLFFBQVFULDBDQUFvQyxFQUFFVSxVQUFVLEdBQUcsTUFBTTtRQUMvRUgsUUFBUUUsS0FBSyxDQUFDLFFBQVEsUUFBU1IsR0FBRyxDQUFDRyx3QkFBd0IsSUFBSUosa05BQXlDLEdBQUksV0FBVztJQUN6SDtJQUVBLElBQUk7UUFDRixpRUFBaUU7UUFDakUsTUFBTVcsYUFBYWQsMERBQUlBO1FBRXZCLElBQUksQ0FBQ2MsWUFBWTtZQUNmSixRQUFRQyxHQUFHLENBQUM7WUFDWixPQUFPVixtRUFBWUEsQ0FBQ0MsYUFBYUk7UUFDbkM7UUFFQSxPQUFPTCxtRUFBWUEsQ0FDakJDLGFBQ0FJLGlCQUNBO1lBQ0VOLE1BQU07Z0JBQ0plLGdCQUFnQjtnQkFDaEJDLGtCQUFrQjtZQUNwQjtZQUNBQyxRQUFRO2dCQUNOQyxTQUFTO29CQUNQLHVCQUF1QjtnQkFDekI7WUFDRjtZQUNBLE1BQU1DO2dCQUNKLElBQUk7b0JBQ0Ysb0RBQW9EO29CQUNwRCxPQUFPLE1BQU1MLFdBQVdNLFFBQVE7Z0JBQ2xDLEVBQUUsT0FBT1IsT0FBTztvQkFDZEYsUUFBUUUsS0FBSyxDQUFDLHNEQUFzREE7b0JBQ3BFLE9BQU87Z0JBQ1Q7WUFDRjtRQUNGO0lBRUosRUFBRSxPQUFPQSxPQUFPO1FBQ2RGLFFBQVFFLEtBQUssQ0FBQyx3Q0FBd0NBO1FBQ3RELE9BQU9YLG1FQUFZQSxDQUFDQyxhQUFhSTtJQUNuQztBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ3JvdXBzaGFyZS1wcm9qZWN0Ly4vc3JjL2xpYi9zdXBhYmFzZS1zZXJ2ZXIuanM/ZmExNyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBzcmMvbGliL3N1cGFiYXNlLXNlcnZlci5qc1xyXG5pbXBvcnQgeyBhdXRoIH0gZnJvbSAnQGNsZXJrL25leHRqcy9zZXJ2ZXInO1xyXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5cclxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw7XHJcbi8vIE9ic8WCdWdhIG9idSBtb8W8bGl3eWNoIG5hencgem1pZW5ueWNoXHJcbmNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0tFWSB8fCBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWTtcclxuXHJcbi8qKlxyXG4gKiBUd29yenkga2xpZW50YSBTdXBhYmFzZSBkbGEgdcW8eWNpYSBwbyBzdHJvbmllIHNlcndlcmEgeiB1d2llcnp5dGVsbmlhbmllbSBDbGVya1xyXG4gKiBcclxuICogQHJldHVybnMge1Byb21pc2U8T2JqZWN0Pn0gS2xpZW50IFN1cGFiYXNlXHJcbiAqL1xyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQoKSB7XHJcbiAgLy8gV3nFm3dpZXRsIGluZm9ybWFjamUgbyBkb3N0xJlwbnljaCB6bWllbm55Y2ggxZtyb2Rvd2lza293eWNoXHJcbiAgY29uc29sZS5sb2coJ0Vudmlyb25tZW50IHZhcmlhYmxlcyBjaGVjazonKTtcclxuICBjb25zb2xlLmxvZygnTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIGV4aXN0czonLCAhIXByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCk7XHJcbiAgY29uc29sZS5sb2coJ05FWFRfUFVCTElDX1NVUEFCQVNFX0tFWSBleGlzdHM6JywgISFwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9LRVkpO1xyXG4gIGNvbnNvbGUubG9nKCdORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSBleGlzdHM6JywgISFwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSk7XHJcbiAgXHJcbiAgaWYgKCFzdXBhYmFzZVVybCB8fCAhc3VwYWJhc2VBbm9uS2V5KSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdNaXNzaW5nIE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCBvciBORVhUX1BVQkxJQ19TVVBBQkFTRV9LRVkvQU5PTl9LRVknKTtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ1VSTDonLCBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw/LnN1YnN0cmluZygwLCAxMCkgKyAnLi4uJyk7XHJcbiAgICBjb25zb2xlLmVycm9yKCdLRVk6JywgKHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0tFWSB8fCBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSkgPyAnZXhpc3RzJyA6ICdtaXNzaW5nJyk7XHJcbiAgfVxyXG4gIFxyXG4gIHRyeSB7XHJcbiAgICAvLyBVxbx5d2FteSBhdXRoKCkgeiBDbGVyaywga3TDs3J5IGplc3QgZG9zdMSZcG55IHBvIHN0cm9uaWUgc2Vyd2VyYVxyXG4gICAgY29uc3QgYXV0aE9iamVjdCA9IGF1dGgoKTtcclxuICAgIFxyXG4gICAgaWYgKCFhdXRoT2JqZWN0KSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdObyBhdXRoIG9iamVjdCBhdmFpbGFibGUgaW4gY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQnKTtcclxuICAgICAgcmV0dXJuIGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGNyZWF0ZUNsaWVudChcclxuICAgICAgc3VwYWJhc2VVcmwsXHJcbiAgICAgIHN1cGFiYXNlQW5vbktleSxcclxuICAgICAge1xyXG4gICAgICAgIGF1dGg6IHtcclxuICAgICAgICAgIHBlcnNpc3RTZXNzaW9uOiBmYWxzZSxcclxuICAgICAgICAgIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlXHJcbiAgICAgICAgfSxcclxuICAgICAgICBnbG9iYWw6IHtcclxuICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgJ3gtY2xlcmstYXV0aC1yZWFzb24nOiAnc3VwYWJhc2UtaW50ZWdyYXRpb24nXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBhc3luYyBhY2Nlc3NUb2tlbigpIHtcclxuICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIFBvYmllcmFteSB0b2tlbiBiZXpwb8WbcmVkbmlvIHphIHBvbW9jxIUgYXBpIGF1dGgoKVxyXG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgYXV0aE9iamVjdC5nZXRUb2tlbigpO1xyXG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2V0dGluZyB0b2tlbiBpbiBjcmVhdGVTZXJ2ZXJTdXBhYmFzZUNsaWVudDonLCBlcnJvcik7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW4gY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQ6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5KTtcclxuICB9XHJcbn0iXSwibmFtZXMiOlsiYXV0aCIsImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlQW5vbktleSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0tFWSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIiwiY3JlYXRlU2VydmVyU3VwYWJhc2VDbGllbnQiLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJzdWJzdHJpbmciLCJhdXRoT2JqZWN0IiwicGVyc2lzdFNlc3Npb24iLCJhdXRvUmVmcmVzaFRva2VuIiwiZ2xvYmFsIiwiaGVhZGVycyIsImFjY2Vzc1Rva2VuIiwiZ2V0VG9rZW4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabase-server.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@clerk","vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/tslib","vendor-chunks/webidl-conversions","vendor-chunks/cookie","vendor-chunks/map-obj","vendor-chunks/no-case","vendor-chunks/lower-case","vendor-chunks/snakecase-keys","vendor-chunks/snake-case","vendor-chunks/dot-case"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Foffers%2Froute&page=%2Fapi%2Foffers%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Foffers%2Froute.js&appDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShareClerk_Supabase%5Cgroupshare-project%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cbacze%5CProject%5CGroupShareClerk_Supabase%5Cgroupshare-project&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();